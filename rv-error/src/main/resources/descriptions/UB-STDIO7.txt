According to ISO C11, it is undefined behavior to call fflush on an input stream or on an input/output stream on which the most recent operation was input. In practice, this may lead to corruption of the stream state and result in incorrect data written to the file or incorrect data read from the file. Flushing input streams is not required, so the correct solution is to remove the call to fflush and call fflush only after a sequence of stream output operations.
