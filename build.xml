<project name="rvpredict" default="all">
  <!-- set global properties for this bin -->
  <property name="rvpredict.engine.src" location="rv-predict-engine/src"/>
  <property name="rvpredict.agent.src" location="rv-predict-agent/src"/>
  <property name="rvpredict.engine.lib" location="rv-predict-engine/lib"/>
  <property name="rvpredict.agent.lib" location="rv-predict-agent/lib"/>
  <property name="rvpredict.engine.bin" location="rv-predict-engine/bin"/>
  <property name="rvpredict.agent.bin" location="rv-predict-agent/bin"/>
  <path id="rv-predict-agent.classpath">
    <pathelement location="${rvpredict.agent.bin}"/>
    <pathelement location="${rvpredict.agent.lib}/h2-1.3.171.jar"/>
    <pathelement location="${rvpredict.agent.lib}/asm.jar"/>
  </path>
  <property name="test.src" location="tests/src"/>
  <property name="test.bin" location="tests/bin"/>
  <property name="benchmark.src" location="benchmarks/src"/>
  <property name="benchmark.bin" location="benchmarks/bin"/>

  <property name="rvpredict.lib" location="lib"/>
  <target name="all" depends="rvpredict-all,benchmarks"
          description="compile rvpredict and benchmarks" />

  <target name="rvpredict-all" depends="rvpredict-engine,rvpredict-agent,tests"
          description="compile rvpredict and test" />

  <target name="rvpredict-engine" depends="init-rvpredict-engine"
          description="compile rvpredict-engine" >
    <javac srcdir="${rvpredict.engine.src}" destdir="${rvpredict.engine.bin}" debug="true" debuglevel="lines,vars,source">
<classpath>
<pathelement location="${rvpredict.engine.lib}/commons-cli-1.2.jar"/>
<pathelement location="${rvpredict.engine.lib}/jigsaw-sexpr.jar"/>
<pathelement location="${rvpredict.engine.lib}/h2-1.3.171.jar"/>
</classpath>
</javac>
<mkdir dir="${rvpredict.lib}"/>
<delete file="${rvpredict.lib}/rv-predict-engine.jar"/>
        <jar destfile="${rvpredict.lib}/rv-predict-engine.jar"
                     basedir="${rvpredict.engine.bin}">
                     <zipgroupfileset dir="${rvpredict.engine.lib}" includes="h2-1.3.171.jar,jigsaw-sexpr.jar,commons-cli-1.2.jar,ant.jar" />
                     </jar>
      </target>
  <target name="init-rvpredict-engine">
      <!-- Create the time stamp -->
    <tstamp/>
        <!-- Create the bin directory structure used by compile -->
    <mkdir dir="${rvpredict.engine.bin}"/>
    <copy includeemptydirs="false" todir="${rvpredict.engine.bin}">
      <fileset dir="${rvpredict.engine.src}">
        <exclude name="**/*.java"/>
        <exclude name="java/io/"/>
        <exclude name="java/"/>
      </fileset>
    </copy>
      </target>

 <target name="init-rvpredict-agent">
      <!-- Create the time stamp -->
    <tstamp/>
        <!-- Create the bin directory structure used by compile -->
    <mkdir dir="${rvpredict.agent.bin}"/>
    <copy includeemptydirs="false" todir="${rvpredict.agent.bin}">
      <fileset dir="${rvpredict.agent.src}">
        <exclude name="**/*.java"/>
        <exclude name="java/io/"/>
        <exclude name="java/"/>
      </fileset>
    </copy>
 </target>

 <target name="clean-rvpredict-agent">
   <delete dir="${rvpredict.agent.bin}" />
   <delete file="${rvpredict.lib}/rv-predict-agent.jar"/>
 </target>

  <target name="clean-rvpredict-engine">
   <delete dir="${rvpredict.engine.bin}" />
   <delete file="${rvpredict.lib}/rv-predict-engine.jar"/>
 </target>
  

<target name="rvpredict-agent" depends="init-rvpredict-agent"
          description="compile rvpredict-agent" >
    <javac srcdir="${rvpredict.agent.src}" destdir="${rvpredict.agent.bin}" debug="true" debuglevel="lines,vars,source" includeantruntime="false">
<classpath refid="rv-predict-agent.classpath"/>
            <exclude name="java/io/"/>
            <exclude name="java/"/>
</javac>
<delete file="${rvpredict.lib}/rv-predict-agent.jar"/>
        <jar destfile="${rvpredict.lib}/rv-predict-agent.jar"
                     basedir="${rvpredict.agent.bin}">
                     <zipgroupfileset dir="${rvpredict.agent.lib}" includes="asm.jar,h2-1.3.171.jar"/>
                     </jar>
                     <copy file="${rvpredict.agent.lib}/iagent.jar" todir="${rvpredict.lib}"/>
      </target>

  <target name="init-benchmarks">
      <!-- Create the time stamp -->
    <tstamp/>
        <!-- Create the bin directory structure used by compile -->
    <mkdir dir="${benchmark.bin}"/>
      </target>
  <target name="benchmarks" depends="init-benchmarks"
          description="compile the benchmark" >
              <!-- Compile the java code from ${benchmark.src} into ${benchmark.bin} -->
    <javac srcdir="${benchmark.src}" destdir="${benchmark.bin}" debug="true" debuglevel="lines,vars,source"/>
      </target>

  <target name="init-tests">
      <!-- Create the time stamp -->
    <tstamp/>
        <!-- Create the bin directory structure used by compile -->
    <mkdir dir="${test.bin}"/>
      </target>
  <target name="tests" depends="init-tests"
          description="compile the tests" >
              <!-- Compile the java code from ${benchmark.src} into ${benchmark.bin} -->
    <javac srcdir="${test.src}" destdir="${test.bin}" debug="true" debuglevel="lines,vars,source"/>
      </target>
  <target name="clean" depends="clean-rvpredict-agent,clean-rvpredict-engine"
          description="clean up" >
              <!-- Delete the ${benchmark.bin} directory trees -->
    <delete dir="${benchmark.bin}"/>
          </target>
          </project>
